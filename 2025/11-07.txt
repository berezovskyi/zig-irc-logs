1762473602
RavenJoad!~user@168.91.208.173
Because right now, the only way to figure out that N-V-__8A... name is by looking at build.zig.zon.json, which is not actually something that build.zig.zon tells us about.

1762473866
grayhatter!~grayhatte@user/grayhatter
rvrb: sounds like the perfect excuse to write your own allocator

1762473965
grayhatter!~grayhatte@user/grayhatter
then you can add it to https://github.com/andrewrk/CarmensPlayground

1762474095
grayhatter!~grayhatte@user/grayhatter
RavenJoad: why do you consider it to be unsensible? 

1762474461
RavenJoad!~user@168.91.208.173
grayhatter: It is only unsensible because the only way to discover the correct name is by looking at a file which is not a core zig build file (AFAIK, only build.zig and build.zig.zon are REQUIRED by the build system). The only other way to get that name is invoke "zig fetch" with $ZIG_GLOBAL_CACHE_DIR unset, and I'm not sure that will require an Internet connection. Guix builds stuff in a container with no networking.

1762475056
RavenJoad!~user@168.91.208.173
On top of that, build.zig.zon.json is generated from build.zig.zon.nix, which itself is generated by zig2nix which reads build.zig.zon. I don't have an ideal answer, but the way Guix handles Golang packages is by using GOPATH and placing go packages in something like "go/github.com/<owner>/<repo>/...". Would rewriting build.zig.zon to point to source inputs in the store be the "best" solution?

1762475207
rvrb!~rvrb@156.146.51.228
RavenJoad: you may want the --system flag: Disable package fetching; enable all integrations

1762475231
RavenJoad!~user@168.91.208.173
rvrb: I already do that. But I still need the dependencies to be present.

1762475338
RavenJoad!~user@168.91.208.173
The problem is not getting the dependencies, but getting them in the right place for Zig (the build tool) and Zig (the compiler) to pick them up.

1762475940
torque!~tachyon@user/torque
it appears that the ghostty main `build.zig.zon` points to `pkg/cimgui/build.zig.zon` for cimgui which includes the hash `N-V-__8AAH0GaQC8a52s6vfIxg88OZgFgEW6DFxfSK4lX_l3`

1762476051
torque!~tachyon@user/torque
which should be all the information you need. I'm not sure why this is missing from build.zig.zon.json (lol). I guess there is some weirdness due to it being generated from the build.zig.zon.nix instead of directly from build.zig.zon

1762476071
RavenJoad!~user@168.91.208.173
It's not missing from the json, it is the key for the imgui json map.

1762476101
RavenJoad!~user@168.91.208.173
So the only way to find this hash is to walk the *.zon files and then regex the ".hash" field? Ok. That's annoying, but not the end of the world.

1762476130
torque!~tachyon@user/torque
well, imgui shows up, but cimgui doesn't, which is confusing to me

1762476180
torque!~tachyon@user/torque
I don't know how ghostty manages their 15 build.zig.zon derivatives, but I would treat `build.zig.zon` itself as the source of truth

1762476192
torque!~tachyon@user/torque
until proven otherwise

1762476216
rvrb!~rvrb@156.146.51.228
torque: zon2nix, used for packaging for Nix; I am still confused why they don't work for Guix given the similar constraints

1762476241
RavenJoad!~user@168.91.208.173
build.zig.zon is the only source of truth that I can work with. The "derivatives" are generated by other tools because zig fetch is not recursive right now.

1762476295
torque!~tachyon@user/torque
well, my point is moreso that `build.zig.zon` indicates that ghostty directly depends on `cimgui` (which itself has a transitive dependency on `imgui`), but `build.zig.zon.nix` doesn't seem to include `cimgui` in the dependency tree

1762476326
squeek502!~squeek502@user/squeek502
rvrb, to add on to your allocator stuff, the allocator API requires that free is called with a slice of the same length as the one that was allocated

1762476328
RavenJoad!~user@168.91.208.173
rvrb: It's not that zon2nix doesn't work. In fact zon2nix will probably serve as a basis for a Zig importer. But installing the package in the right spot is the hard part and zon2nix does not specify that. 

1762476425
torque!~tachyon@user/torque
the build.zig.zon.nix computes the hash directly upon download, presumably in the same way that the zig package system does

1762476449
RavenJoad!~user@168.91.208.173
torque: I think the zon.nix does not include cimgui because cimgui is "vendored" and relies on imgui.

1762476452
torque!~tachyon@user/torque
actually I can read lol it uses `zig fetch` to download it

1762476505
torque!~tachyon@user/torque
ah yeah that makes sense

1762476553
rvrb!~rvrb@156.146.51.228
oh, I see, the literal string you need is not in the JSON; I expected that it was. I think I am caught up and cannot be helpful :P

1762476587
RavenJoad!~user@168.91.208.173
My core issue was finding the hash name that Zig expects a package to be in. If walking the .zon's is the only way; I don't like it, but so be it. 

1762476599
torque!~tachyon@user/torque
I'm a bit confused actualy

1762476613
RavenJoad!~user@168.91.208.173
rvrb: It is in the JSON. I just cannot rely on the JSON since Zig (the build tool) does not generate or use it.

1762476621
torque!~tachyon@user/torque
ah ok

1762476632
rvrb!~rvrb@156.146.51.228
like, as a matter of Guix contribution guidelines?

1762476637
torque!~tachyon@user/torque
yeah sorry I confused things by mixing up cimgui and imgui

1762476717
RavenJoad!~user@168.91.208.173
Perhaps cimgui was a bad example. A better one might have been glslang or spirv-cross, which don't quote vendor the same way.

1762476751
RavenJoad!~user@168.91.208.173
But the point stands. If I have to find the "N-V-__..." name by walking .zon's somehow, then ok.

1762476786
rvrb!~rvrb@156.146.51.228
seems like the most direct approach in any case

1762476853
torque!~tachyon@user/torque
if you don't want to use the json (I can understand not wanting to use a derivative source for this) then the only other way I see is to compute the hash on download the same way `zig fetch` does, which seems like a lot of work

1762477142
RavenJoad!~user@168.91.208.173
torque: Walking the .zon's is fine. Guix should not try to match and/or keep up with Zig in how it computes dependency hashes. Walking the .zon's is fine, so long as that finds and (more or less) matches what Zig does.

1762482717
p00f!ad2b9023b7@2a03:6000:1812:100::d93
i thought build.zig.zon wanted relative paths to disallow local dependencies outside the project

1762482732
p00f!ad2b9023b7@2a03:6000:1812:100::d93
just found out you can have the path start with ..

1762482747
p00f!ad2b9023b7@2a03:6000:1812:100::d93
what is the rationale for not allowing absolute paths then?

1762486728
grayhatter!~grayhatte@user/grayhatter
p00f: relative paths can still make sense outside of a repo; absolute paths can not

1762486868
grayhatter!~grayhatte@user/grayhatter
main_megarepo/code/zigcode/project_one can safely, and correctly reference ../project_two but `/var/sourcecode/main_megarepo/code/zigcode/project_two` isn't a directory that should resonably expected to be correct 

1762486984
p00f!ad2b9023b7@2a03:6000:1812:100::d93
I see

1762487032
grayhatter!~grayhatte@user/grayhatter
I use .path = "../verse" all the time in srctree... but I would be annoyed at me if I committed that to the repo... but having that as a feature has saved me HOURS of work

1762487083
grayhatter!~grayhatte@user/grayhatter
ideally, you'd never use it, but it's one of the few nice things zig permits (also.... shhh.... don't call attention to it, I don't want it taken away :P )

1762496553
ledx_!~thomas@user/ledx
squeek502: thanks! got it working :)

1762516489
clevor!sid649024@id-649024.hampstead.irccloud.com
Writing this parsing code for the 9P protocol, there's something so satisfying adding a `try reader.fill()`, verifying the message isn't too small, and then changing my `try reader.takeBlah()` into `reader.takeBlah() catch unreachable`. The only issue I've had so far is that there is no `std.Io.Writer.writeEnum`. https://en.wikipedia.org/wiki/9P_(protocol)

1762516811
clevor!sid649024@id-649024.hampstead.irccloud.com
At the same time, it makes the code slightly more verbose, but at least it's clear.

1762520354
bblack!~bblack@wikimedia/bblack-WMF
I just had yet another one of those Zig Moments.  Where I waded through a difficult refactoring job on some complex code, and reached the first point of seeming-completion.  Time to run the tests and see what crashes or fails and go bug-hunting for a while... but the first run just works the first time.

1762520370
bblack!~bblack@wikimedia/bblack-WMF
It's jarring, because it's so much easier to get things right the first time than what I'm used to :P

1762520405
sjohnson!~sjohnson@user/sjohnson
good times!

1762520919
clevor!sid649024@id-649024.hampstead.irccloud.com
bblack: Yesterday, my PoC was crashing for an unknown reason, until I figured out that the size field is actually included *twice* in the `stat[n]` part of the Rstat message. https://man.cat-v.org/plan_9/5/stat

1762520988
clevor!sid649024@id-649024.hampstead.irccloud.com
Ideally, the size would be calculated from the 4-byte length prefix at the beginning.

1762521235
bblack!~bblack@wikimedia/bblack-WMF
at least they called it out as a BUG in the manpage :)

1762521283
clevor!sid649024@id-649024.hampstead.irccloud.com
That's how I found out :p

1762521308
bblack!~bblack@wikimedia/bblack-WMF
it's been so long since I've messed with anything Plan9 related.  I used to have some actual Plan9 machines at home, many many years ago, to play with.

1762521332
bblack!~bblack@wikimedia/bblack-WMF
was probably the late 90s or so heh

1762521578
clevor!sid649024@id-649024.hampstead.irccloud.com
I have it running in a VM on my laptop. As for my Raspberry Pi 4, I don't think it could run it in bare-metal as the source code for 9legacy hasn't been changed in any meaningful way since then.

1762521651
bblack!~bblack@wikimedia/bblack-WMF
yeah, I used to have a couple x86 machines running networks as cpu/auth + file server roles IIRC

1762521688
bblack!~bblack@wikimedia/bblack-WMF
so many nifty concepts came out of P9 that spread to Linux later, so in that sense I consider it a research success story for sure.

1762522866
clevor!sid649024@id-649024.hampstead.irccloud.com
My Compaq Presario F700's Wi-Fi card and GPU aren't on the list of supported devices :/

1762523651
JetpackJackson!739e7f3d14@user/JetpackJackson
I played around with 9front the other day, it was pretty neat tbh but the lack of support for a lot of WiFi cards was a bummer

1762528093
nicefries!~nicefries@user/nicefries
does anybody know how to display tracy when invoking the compiler

